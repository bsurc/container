Bootstrap: docker
From: rockylinux:8

%environment
export LC_ALL=C

%files

pkgs.R /opt/

%post

export LC_ALL=C

export R_VERSION=4.3.1

export PKG="dnf -y"

$PKG update
$PKG install dnf-plugins-core
$PKG install epel-release
$PKG config-manager --set-enabled powertools
$PKG update

$PKG groupinstall "Development Tools"

$PKG install \
	cmake \
	fontconfig-devel \
	fribidi-devel \
	gdal-devel \
	geos-devel \
	glibc-devel \
	glibc-devel.i686 \
	gsl-devel \
	harfbuzz-devel \
	lapack-devel \
	libjpeg-turbo-devel \
	libpng-devel \
	libtiff-devel \
	libxml2-devel \
	netcdf-devel \
	openblas-devel \
	openssl-devel \
	proj-devel \
	sqlite-devel \
	udunits2-devel

cd /opt
curl -O https://cdn.rstudio.com/r/centos-8/pkgs/R-${R_VERSION}-1-1.x86_64.rpm
yum -y install R-${R_VERSION}-1-1.x86_64.rpm

ln -s /opt/R/${R_VERSION}/bin/R /usr/local/bin/R
ln -s /opt/R/${R_VERSION}/bin/Rscript /usr/local/bin/Rscript

cd /opt
curl -L -o download.tar.gz https://sourceforge.net/projects/mcmc-jags/files/JAGS/4.x/Source/JAGS-4.3.0.tar.gz/download
tar -xf download.tar.gz
cd JAGS-4.3.0
./configure
make -j 6
make install

cd /opt
curl -LO https://www.mrc-bsu.cam.ac.uk/wp-content/uploads/2018/04/OpenBUGS-3.2.3.tar.gz
tar -xf OpenBUGS-3.2.3.tar.gz
cd OpenBUGS-3.2.3
./configure
make -j 6
make install

cd /opt
Rscript pkgs.R

%help

%labels
author Kyle Shannon <kyle@pobox.com>
