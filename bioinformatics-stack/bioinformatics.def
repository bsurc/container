Bootstrap: docker
From: ubuntu:focal


%files

%post
	export DEBIAN_FRONTEND="noninteractive"
	apt -y update && apt -y dist-upgrade
	apt -y install wget bzip2 unzip zip git
	apt -y install default-jre default-jdk
	apt -y install samtools

	# Install conda
	wget https://repo.anaconda.com/miniconda/Miniconda3-latest-Linux-x86_64.sh
	chmod +x Miniconda3-latest-Linux-x86_64.sh
	bash ./Miniconda3-latest-Linux-x86_64.sh -b -p /opt/conda
     	. /opt/conda/etc/profile.d/conda.sh
    	conda activate base
    	conda update --yes --all
    	conda clean --yes --all
	rm ./Miniconda3-latest-Linux-x86_64.sh

	# Install mamba and getorganelle, treeshrink, biopython	
	conda install -n base -c conda-forge mamba
	mamba install -c conda-forge -c bioconda -c smirarab biopython bmge bwa getorganelle treeshrink parallel

	# Download and Extract ASTRAL
	wget https://github.com/smirarab/ASTRAL/raw/master/Astral.5.7.8.zip
	unzip Astral.5.7.8.zip -d /opt
	chmod -R 777 /opt/Astral

	# Download and Extract bpp
	wget https://github.com/bpp/bpp/releases/download/v4.4.1/bpp-4.4.1-linux-x86_64.tar.gz
	tar zxvf bpp-4.4.1-linux-x86_64.tar.gz -C /opt
	# Download and Extract exonerate
	wget http://ftp.ebi.ac.uk/pub/software/vertebrategenomics/exonerate/exonerate-2.2.0-x86_64.tar.gz
	tar zxvf exonerate-2.2.0-x86_64.tar.gz -C /opt
	# Download FastTree
	wget http://www.microbesonline.org/fasttree/FastTree
	mkdir /opt/fasttree
	mv FastTree /opt/fasttree
	chmod -R +x /opt/fasttree

%environment
 	export LC_ALL=C.UTF-8
    	export PATH=/opt/conda/bin:/opt/bpp-4.4.1-linux-x86_64/bin:/opt/exonerate-2.2.0-x86_64/bin:/opt/fasttree:$PATH

%runscript

%startscript
