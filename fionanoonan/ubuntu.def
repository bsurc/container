Bootstrap: docker
From: ubuntu:20.04

%environment

export LC_ALL=C

%post

export LC_ALL=C

apt update
apt upgrade -y

apt install -y software-properties-common
add-apt-repository ppa:ubuntugis/ppa

DEBIAN_FRONTEND=NONINTERACTIVE apt install -y \
  bison \
  build-essential \
  cmake \
  flex \
  gdb \
  git \
  libexpat-dev \
  libgdal-dev \
  libgeos-dev \
  libgit2-dev \
  libtool \
  libproj-dev \
  libsqlite3-dev \
  libudunits2-dev \
  libxml2-dev \
  r-base \
  texinfo \
  tzdata \
  valgrind

cd /opt

cat << EOF > pkgs.R

pkgs <- c(
  'codetools',
  'devtools',
  'raster',
  'dplyr',
  'rgeos',
  'rgdal',
  'sp',
  'sf',
  'maptools',
  'ggplot2',
  'wesanderson',
  'units',
  'ggnewscale',
  'terra',
  'scales',
  'remotes',
  'igraph',
  'spdep',
  'spatialreg',
  'RColorBrewer',
  'tmap',
  'brms',
  'tidyr',
  'purrr',
  'tibble',
  'stringr',
  'forcats',
  'readr',
  'ggdist',
  'tidybayes',
  'ape',
  'CARBayes',
  'coda',
  'yardstick'
  )

install.packages(pkgs, repo='https://ftp.osuosl.org/pub/cran/', Ncpus=24)

EOF

Rscript pkgs.R

%test

# make sure we can load all the packages we downloaded/installed

R -e "library(codetools)"
R -e "library(devtools)"
R -e "library(raster)"
R -e "library(dplyr)"
R -e "library(rgeos)"
R -e "library(rgdal)"
R -e "library(sp)"
R -e "library(sf)"
R -e "library(maptools)"
R -e "library(ggplot2)"
R -e "library(wesanderson)"
R -e "library(units)"
R -e "library(ggnewscale)"
R -e "library(terra)"
R -e "library(scales)"
R -e "library(remotes)"
R -e "library(igraph)"
R -e "library(spdep)"
R -e "library(spatialreg)"
R -e "library(RColorBrewer)"
R -e "library(tmap)"
R -e "library(brms)"
R -e "library(tidyr)"
R -e "library(purrr)"
R -e "library(tibble)"
R -e "library(stringr)"
R -e "library(forcats)"
R -e "library(readr)"
R -e "library(ggdist)"
R -e "library(tidybayes)"
R -e "library(ape)"
R -e "library(coda)"
R -e "library(yardstick)"

%help

This container supplies dependencies for Fiona Noonan's thesis project.

%labels

author "Kyle Shannon <kyle@pobox.com>
